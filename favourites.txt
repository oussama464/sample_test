DO $$
DECLARE
  r record;
  seq_name text;
BEGIN
  FOR r IN
    SELECT
      c.table_name,
      c.column_name,
      pg_get_serial_sequence(quote_ident(c.table_name), c.column_name) AS seq
    FROM information_schema.columns c
    WHERE c.table_schema = 'public'
      AND c.column_default LIKE 'nextval(%'
      AND pg_get_serial_sequence(quote_ident(c.table_name), c.column_name) IS NOT NULL
  LOOP
    seq_name := r.seq;

    EXECUTE format(
      'SELECT setval(%L, (SELECT COALESCE(MAX(%I),0)+1 FROM %I), false);',
      seq_name, r.column_name, r.table_name
    );
  END LOOP;
END $$;









UPDATE task_reschedule
SET task_id = replace(task_id, 'ETLs.bonds.', 'ETLs.fxpm.')
WHERE dag_id = 'YOUR_DAG_ID_HERE'
  AND task_id LIKE 'ETLs.bonds.%';

-- Optional: Airflow UI event log table (nice to keep consistent)
UPDATE log
SET task_id = replace(task_id, 'ETLs.bonds.', 'ETLs.fxpm.')
WHERE dag_id = 'YOUR_DAG_ID_HERE'
  AND task_id LIKE 'ETLs.bonds.%';


-- 3) Remove old parent rows
DELETE FROM task_instance
WHERE dag_id = 'YOUR_DAG_ID_HERE'
  AND task_id LIKE 'ETLs.bonds.%';

COMMIT;

